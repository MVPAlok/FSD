<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Student Marks System</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --success-gradient: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            --warning-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --danger-gradient: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            --dark-gradient: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            --gold-gradient: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);
            --glass-bg: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.18);
            --shadow-light: 0 8px 32px rgba(31, 38, 135, 0.37);
            --shadow-strong: 0 15px 35px rgba(0, 0, 0, 0.1);
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #4facfe 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        .floating-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .shape {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        .shape:nth-child(1) {
            width: 80px;
            height: 80px;
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }

        .shape:nth-child(2) {
            width: 120px;
            height: 120px;
            top: 60%;
            left: 80%;
            animation-delay: -2s;
        }

        .shape:nth-child(3) {
            width: 60px;
            height: 60px;
            top: 40%;
            left: 70%;
            animation-delay: -4s;
        }

        .shape:nth-child(4) {
            width: 100px;
            height: 100px;
            top: 80%;
            left: 20%;
            animation-delay: -1s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-light);
            overflow: hidden;
            animation: slideUp 1s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .header {
            background: var(--secondary-gradient);
            padding: 40px;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            font-weight: 800;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            letter-spacing: -1px;
        }

        .header p {
            font-size: 1.3rem;
            opacity: 0.95;
            font-weight: 300;
        }

        .main-content {
            padding: 40px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: var(--shadow-strong);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow: hidden;
            position: relative;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--secondary-gradient);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .card:hover::before {
            transform: scaleX(1);
        }

        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            padding: 25px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-body {
            padding: 25px;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .input-container {
            position: relative;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
            background: white;
            color: var(--text-primary);
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
            transform: translateY(-2px);
        }

        .input-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            z-index: 3;
            font-size: 1.1rem;
        }

        .btn {
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            font-family: inherit;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            min-height: 54px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: var(--secondary-gradient);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(79, 172, 254, 0.4);
        }

        .btn-secondary {
            background: var(--primary-gradient);
            color: white;
        }

        .btn-success {
            background: var(--success-gradient);
            color: white;
        }

        .btn-warning {
            background: var(--warning-gradient);
            color: white;
        }

        .btn-danger {
            background: var(--danger-gradient);
            color: white;
        }

        .btn-dark {
            background: var(--dark-gradient);
            color: white;
        }

        .btn-gold {
            background: var(--gold-gradient);
            color: white;
        }

        .btn:not(.btn-primary):hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        .actions-grid {
            display: grid;
            gap: 15px;
        }

        .action-btn {
            width: 100%;
            justify-content: center;
            text-align: center;
        }

        .results-section {
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: var(--shadow-strong);
            margin-top: 30px;
            overflow: hidden;
        }

        .results-header {
            background: var(--dark-gradient);
            color: white;
            padding: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .results-title {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .view-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .view-btn {
            padding: 8px 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: transparent;
            color: white;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-btn:hover, .view-btn.active {
            background: white;
            color: var(--text-primary);
            transform: translateY(-2px);
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: var(--shadow-strong);
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--secondary-gradient);
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            display: block;
        }

        .stat-value {
            font-size: 2.8rem;
            font-weight: 800;
            margin-bottom: 8px;
            background: var(--secondary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .results-content {
            padding: 30px;
            max-height: 600px;
            overflow-y: auto;
        }

        .results-content::-webkit-scrollbar {
            width: 6px;
        }

        .results-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .results-content::-webkit-scrollbar-thumb {
            background: var(--secondary-gradient);
            border-radius: 10px;
        }

        .student-card {
            background: white;
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #4facfe;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: fadeInUp 0.6s ease-out;
            position: relative;
            overflow: hidden;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .student-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(79, 172, 254, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .student-card:hover::before {
            opacity: 1;
        }

        .student-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
        }

        .student-card.passed {
            border-left-color: #28a745;
        }

        .student-card.failed {
            border-left-color: #dc3545;
        }

        .student-card.topper {
            border-left-color: #ffc107;
            background: linear-gradient(135deg, #fff9c4 0%, #fff3cd 100%);
            position: relative;
        }

        .student-card.topper::after {
            content: '👑';
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.8rem;
            animation: bounce 2s infinite, rotate 4s linear infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0) rotate(var(--rotation, 0deg));
            }
            40% {
                transform: translateY(-10px) rotate(var(--rotation, 0deg));
            }
            60% {
                transform: translateY(-5px) rotate(var(--rotation, 0deg));
            }
        }

        @keyframes rotate {
            from { --rotation: 0deg; }
            to { --rotation: 360deg; }
        }

        .student-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .student-name {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .student-id {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .student-marks {
            font-size: 1.3rem;
            font-weight: 700;
            padding: 12px 20px;
            border-radius: 25px;
            background: var(--secondary-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
        }

        .student-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .detail-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .detail-value {
            font-weight: 500;
            color: var(--text-primary);
        }

        .student-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            padding: 6px 14px;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-passed {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-failed {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .student-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
            min-height: auto;
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 5rem;
            margin-bottom: 25px;
            opacity: 0.6;
        }

        .empty-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .empty-text {
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 20px 25px;
            border-radius: 15px;
            color: white;
            font-weight: 600;
            font-size: 15px;
            z-index: 1000;
            transform: translateX(400px);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: var(--shadow-strong);
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 400px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: var(--success-gradient);
        }

        .notification.error {
            background: var(--danger-gradient);
        }

        .notification.info {
            background: var(--secondary-gradient);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            position: relative;
            animation: modalSlideUp 0.4s ease-out;
        }

        @keyframes modalSlideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--text-primary);
        }

        .search-bar {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 25px;
            font-size: 16px;
            background: white;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 1.2rem;
        }

        .grade-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .grade-a { background: #d4edda; color: #155724; }
        .grade-b { background: #d1ecf1; color: #0c5460; }
        .grade-c { background: #fff3cd; color: #856404; }
        .grade-d { background: #f8d7da; color: #721c24; }
        .grade-f { background: #f8d7da; color: #721c24; }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr 1fr;
                gap: 25px;
                padding: 30px;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .header p {
                font-size: 1.1rem;
            }
            
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
                padding: 20px;
            }
            
            .student-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .view-controls {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .notification {
                right: 15px;
                left: 15px;
                transform: translateY(-100px);
                max-width: none;
            }
            
            .notification.show {
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <div class="container">
        <div class="header">
            <h1>🎓 Advanced Student Marks System</h1>
            <p>Comprehensive student performance management with advanced analytics</p>
        </div>

        <div class="main-content">
            <!-- Add Student Section -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <span>➕</span> Add New Student
                    </h2>
                </div>
                <div class="card-body">
                    <form id="studentForm">
                        <div class="form-group">
                            <label for="studentName">Full Name</label>
                            <div class="input-container">
                                <input type="text" id="studentName" placeholder="Enter student's full name..." required>
                                <span class="input-icon">👤</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="studentId">Student ID</label>
                            <div class="input-container">
                                <input type="text" id="studentId" placeholder="Enter student ID..." required>
                                <span class="input-icon">🆔</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="studentMarks">Marks (0-100)</label>
                            <div class="input-container">
                                <input type="number" id="studentMarks" min="0" max="100" placeholder="Enter marks..." required>
                                <span class="input-icon">📝</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="subject">Subject</label>
                            <div class="input-container">
                                <select id="subject" required>
                                    <option value="">Select Subject</option>
                                    <option value="Mathematics">Mathematics</option>
                                    <option value="Physics">Physics</option>
                                    <option value="Chemistry">Chemistry</option>
                                    <option value="Biology">Biology</option>
                                    <option value="English">English</option>
                                    <option value="History">History</option>
                                    <option value="Geography">Geography</option>
                                    <option value="Computer Science">Computer Science</option>
                                </select>
                                <span class="input-icon">📚</span>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <span>✨</span> Add Student
                        </button>
                    </form>
                </div>
            </div>

            <!-- Quick Actions Section -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <span>⚡</span> Quick Actions
                    </h2>
                </div>
                <div class="card-body">
                    <div class="actions-grid">
                        <button class="btn btn-secondary action-btn" onclick="showAllStudents()">
                            <span>👥</span> All Students
                        </button>
                        <button class="btn btn-success action-btn" onclick="showPassedStudents()">
                            <span>✅</span> Passed Students
                        </button>
                        <button class="btn btn-danger action-btn" onclick="showFailedStudents()">
                            <span>❌</span> Failed Students
                        </button>
                        <button class="btn btn-warning action-btn" onclick="showByGrade()">
                            <span>🎯</span> By Grade
                        </button>
                        <button class="btn btn-dark action-btn" onclick="calculateAverage()">
                            <span>📊</span> Statistics
                        </button>
                        <button class="btn btn-gold action-btn" onclick="findTopper()">
                            <span>👑</span> Find Topper
                        </button>
                    </div>
                </div>
            </div>

            <!-- Advanced Features Section -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <span>🔧</span> Advanced Tools
                    </h2>
                </div>
                <div class="card-body">
                    <div class="actions-grid">
                        <button class="btn btn-secondary action-btn" onclick="exportData()">
                            <span>📁</span> Export Data
                        </button>
                        <button class="btn btn-success action-btn" onclick="importData()">
                            <span>📥</span> Import Data
                        </button>
                        <button class="btn btn-warning action-btn" onclick="editStudent()">
                            <span>✏️</span> Edit Student
                        </button>
                        <button class="btn btn-danger action-btn" onclick="deleteStudent()">
                            <span>🗑️</span> Delete Student
                        </button>
                        <button class="btn btn-dark action-btn" onclick="clearAllData()">
                            <span>🧹</span> Clear All
                        </button>
                        <button class="btn btn-gold action-btn" onclick="generateReport()">
                            <span>📋</span> Report
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section">
            <div class="results-header">
                <h2 class="results-title">
                    <span>📈</span> <span id="currentViewTitle">Dashboard</span>
                </h2>
                <div class="view-controls">
                    <button class="view-btn" onclick="showDashboard()">📊 Dashboard</button>
                    <button class="view-btn" onclick="showAllStudents()">👥 All</button>
                    <button class="view-btn" onclick="showPassedStudents()">✅ Passed</button>
                    <button class="view-btn" onclick="showFailedStudents()">❌ Failed</button>
                    <button class="view-btn" onclick="showByGrade()">🎯 Grades</button>
                </div>
            </div>

            <!-- Search Bar -->
            <div style="padding: 20px 30px 0;">
                <div class="search-bar">
                    <input type="text" class="search-input" id="searchInput" placeholder="Search students by name, ID, or subject..." onkeyup="searchStudents()">
                    <span class="search-icon">🔍</span>
                </div>
            </div>

            <!-- Statistics Container -->
            <div id="statsContainer" class="stats-container">
                <div class="stat-card">
                    <span class="stat-icon">👥</span>
                    <div class="stat-value" id="totalStudents">0</div>
                    <div class="stat-label">Total Students</div>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">✅</span>
                    <div class="stat-value" id="passedStudents">0</div>
                    <div class="stat-label">Passed (≥40)</div>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">❌</span>
                    <div class="stat-value" id="failedStudents">0</div>
                    <div class="stat-label">Failed (<40)</div>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">📊</span>
                    <div class="stat-value" id="averageMarks">0</div>
                    <div class="stat-label">Average Marks</div>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">👑</span>
                    <div class="stat-value" id="topperMarks">0</div>
                    <div class="stat-label">Highest Score</div>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">📈</span>
                    <div class="stat-value" id="passRate">0%</div>
                    <div class="stat-label">Pass Rate</div>
                </div>
            </div>

            <div class="results-content" id="resultsContainer">
                <div class="empty-state">
                    <div class="empty-icon">📋</div>
                    <h3 class="empty-title">Welcome to Student Marks System</h3>
                    <p class="empty-text">Start by adding students to track their performance and generate comprehensive analytics.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Edit/Delete -->
    <div id="actionModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        let students = [];
        let currentView = 'dashboard';
        let filteredStudents = [];

        // Initialize the system
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            showDashboard();
        });

        // Form submission
        document.getElementById('studentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('studentName').value.trim();
            const studentId = document.getElementById('studentId').value.trim();
            const marks = parseInt(document.getElementById('studentMarks').value);
            const subject = document.getElementById('subject').value;

            if (!validateForm(name, studentId, marks, subject)) {
                return;
            }

            const student = {
                id: studentId,
                name: name,
                marks: marks,
                subject: subject,
                passed: marks >= 40,
                grade: calculateGrade(marks),
                dateAdded: new Date().toLocaleDateString(),
                timeAdded: new Date().toLocaleTimeString()
            };

            students.push(student);
            
            // Clear form
            document.getElementById('studentForm').reset();
            
            showNotification(`${name} added successfully! 🎉`, 'success');
            updateStats();
            saveData();
            
            // Refresh current view
            refreshCurrentView();
        });

        function validateForm(name, studentId, marks, subject) {
            if (name === '') {
                showNotification('Please enter a valid name! 📝', 'error');
                return false;
            }

            if (studentId === '') {
                showNotification('Please enter a student ID! 🆔', 'error');
                return false;
            }

            if (marks < 0 || marks > 100 || isNaN(marks)) {
                showNotification('Marks must be between 0 and 100! 📊', 'error');
                return false;
            }

            if (subject === '') {
                showNotification('Please select a subject! 📚', 'error');
                return false;
            }

            // Check for duplicate student ID
            if (students.some(student => student.id.toLowerCase() === studentId.toLowerCase())) {
                showNotification('Student ID already exists! Please use a unique ID 🆔', 'error');
                return false;
            }

            return true;
        }

        function calculateGrade(marks) {
            if (marks >= 90) return 'A+';
            if (marks >= 80) return 'A';
            if (marks >= 70) return 'B+';
            if (marks >= 60) return 'B';
            if (marks >= 50) return 'C+';
            if (marks >= 40) return 'C';
            if (marks >= 30) return 'D';
            return 'F';
        }

        function getGradeClass(grade) {
            if (grade.startsWith('A')) return 'grade-a';
            if (grade.startsWith('B')) return 'grade-b';
            if (grade.startsWith('C')) return 'grade-c';
            if (grade === 'D') return 'grade-d';
            return 'grade-f';
        }

        function updateStats() {
            const total = students.length;
            const passed = students.filter(s => s.passed).length;
            const failed = total - passed;
            const average = total > 0 ? Math.round(students.reduce((sum, s) => sum + s.marks, 0) / total) : 0;
            const highest = total > 0 ? Math.max(...students.map(s => s.marks)) : 0;
            const passRate = total > 0 ? Math.round((passed / total) * 100) : 0;

            document.getElementById('totalStudents').textContent = total;
            document.getElementById('passedStudents').textContent = passed;
            document.getElementById('failedStudents').textContent = failed;
            document.getElementById('averageMarks').textContent = average;
            document.getElementById('topperMarks').textContent = highest;
            document.getElementById('passRate').textContent = `${passRate}%`;
        }

        function displayStudents(studentsToShow, title = '', emptyMessage = '') {
            setActiveView(currentView);
            document.getElementById('currentViewTitle').textContent = title || 'Results';
            
            const container = document.getElementById('resultsContainer');
            
            if (studentsToShow.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">😔</div>
                        <h3 class="empty-title">${emptyMessage || 'No students found'}</h3>
                        <p class="empty-text">${title ? `No students match the criteria for: ${title}` : 'Try adding some students or adjusting your search.'}</p>
                    </div>
                `;
                return;
            }

            let html = '';
            studentsToShow.forEach((student, index) => {
                const isTopper = student.marks === Math.max(...students.map(s => s.marks));
                const cardClass = `student-card ${student.passed ? 'passed' : 'failed'} ${isTopper ? 'topper' : ''}`;
                
                html += `
                    <div class="${cardClass}" style="animation-delay: ${index * 0.1}s">
                        <div class="student-header">
                            <div>
                                <div class="student-name">${student.name}</div>
                                <div class="student-id">ID: ${student.id}</div>
                            </div>
                            <div class="student-marks">${student.marks}/100</div>
                        </div>
                        <div class="student-details">
                            <div class="detail-item">
                                <span class="detail-label">Subject:</span>
                                <span class="detail-value">${student.subject}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Grade:</span>
                                <span class="grade-badge ${getGradeClass(student.grade)}">${student.grade}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Status:</span>
                                <span class="student-status status-${student.passed ? 'passed' : 'failed'}">
                                    ${student.passed ? '✅ PASSED' : '❌ FAILED'}
                                </span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Added:</span>
                                <span class="detail-value">${student.dateAdded}</span>
                            </div>
                        </div>
                        <div class="student-actions">
                            <button class="btn btn-warning btn-sm" onclick="editStudentById('${student.id}')">
                                <span>✏️</span> Edit
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteStudentById('${student.id}')">
                                <span>🗑️</span> Delete
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function setActiveView(viewName) {
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const activeBtn = document.querySelector(`[onclick*="${viewName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
        }

        function showDashboard() {
            currentView = 'dashboard';
            setActiveView('showDashboard');
            document.getElementById('currentViewTitle').textContent = 'Dashboard Overview';
            
            const container = document.getElementById('resultsContainer');
            
            if (students.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">📊</div>
                        <h3 class="empty-title">Dashboard</h3>
                        <p class="empty-text">Add students to see comprehensive analytics and performance insights here.</p>
                    </div>
                `;
                return;
            }

            // Show recent students and top performers
            const recentStudents = [...students].sort((a, b) => new Date(b.dateAdded) - new Date(a.dateAdded)).slice(0, 3);
            const topPerformers = [...students].sort((a, b) => b.marks - a.marks).slice(0, 3);
            
            let html = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-bottom: 30px;">
                    <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 20px; color: #4facfe; display: flex; align-items: center; gap: 10px;">
                            <span>🕒</span> Recent Additions
                        </h3>
            `;
            
            recentStudents.forEach(student => {
                html += `
                    <div style="padding: 15px; border-left: 3px solid #4facfe; margin-bottom: 15px; background: #f8f9fa;">
                        <div style="font-weight: 600; color: #333;">${student.name}</div>
                        <div style="color: #666; font-size: 0.9rem;">${student.subject} • ${student.marks}/100 • ${student.dateAdded}</div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                    <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 20px; color: #ffc107; display: flex; align-items: center; gap: 10px;">
                            <span>👑</span> Top Performers
                        </h3>
            `;
            
            topPerformers.forEach((student, index) => {
                const medals = ['🥇', '🥈', '🥉'];
                html += `
                    <div style="padding: 15px; border-left: 3px solid #ffc107; margin-bottom: 15px; background: #fff9c4;">
                        <div style="font-weight: 600; color: #333; display: flex; align-items: center; gap: 8px;">
                            <span>${medals[index] || '🏆'}</span> ${student.name}
                        </div>
                        <div style="color: #666; font-size: 0.9rem;">${student.subject} • ${student.marks}/100 • Grade ${student.grade}</div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;

            // Subject-wise performance
            const subjectStats = {};
            students.forEach(student => {
                if (!subjectStats[student.subject]) {
                    subjectStats[student.subject] = { total: 0, sum: 0, passed: 0 };
                }
                subjectStats[student.subject].total++;
                subjectStats[student.subject].sum += student.marks;
                if (student.passed) subjectStats[student.subject].passed++;
            });

            html += `
                <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px;">
                    <h3 style="margin-bottom: 20px; color: #28a745; display: flex; align-items: center; gap: 10px;">
                        <span>📚</span> Subject-wise Performance
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            `;

            Object.entries(subjectStats).forEach(([subject, stats]) => {
                const avg = Math.round(stats.sum / stats.total);
                const passRate = Math.round((stats.passed / stats.total) * 100);
                
                html += `
                    <div style="padding: 20px; background: #f8f9fa; border-radius: 12px; text-align: center; border: 2px solid #e9ecef;">
                        <div style="font-weight: 700; color: #333; margin-bottom: 10px;">${subject}</div>
                        <div style="color: #4facfe; font-size: 1.5rem; font-weight: 700; margin-bottom: 5px;">${avg}</div>
                        <div style="color: #666; font-size: 0.9rem; margin-bottom: 8px;">Average Marks</div>
                        <div style="color: ${passRate >= 70 ? '#28a745' : passRate >= 50 ? '#ffc107' : '#dc3545'}; font-weight: 600;">${passRate}% Pass Rate</div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;

            container.innerHTML = html;
        }

        function showAllStudents() {
            currentView = 'all';
            if (students.length === 0) {
                showNotification('No students added yet! 📚', 'info');
                displayStudents([], 'All Students', 'No students have been added to the system yet.');
                return;
            }
            const sorted = [...students].sort((a, b) => b.marks - a.marks);
            displayStudents(sorted, `All Students (${students.length} total)`, 'No students found in the system.');
        }

        function showPassedStudents() {
            currentView = 'passed';
            const passedStudents = students.filter(s => s.passed).sort((a, b) => b.marks - a.marks);
            if (passedStudents.length === 0) {
                showNotification('No students have passed yet! 📈', 'info');
                displayStudents([], 'Passed Students (≥40 marks)', 'No students have achieved passing marks yet.');
                return;
            }
            displayStudents(passedStudents, `Passed Students (${passedStudents.length} of ${students.length})`, 'No students have passed with ≥40 marks.');
        }

        function showFailedStudents() {
            currentView = 'failed';
            const failedStudents = students.filter(s => !s.passed).sort((a, b) => b.marks - a.marks);
            if (failedStudents.length === 0) {
                showNotification('Great! No students have failed! 🎉', 'success');
                displayStudents([], 'Failed Students (<40 marks)', 'Excellent! No students have failed.');
                return;
            }
            displayStudents(failedStudents, `Failed Students (${failedStudents.length} of ${students.length})`, 'No students have failed.');
        }

        function showByGrade() {
            currentView = 'grade';
            if (students.length === 0) {
                showNotification('No students to show grades for! 📊', 'info');
                displayStudents([], 'Students by Grade', 'Add students to see grade distribution.');
                return;
            }
            
            setActiveView('showByGrade');
            document.getElementById('currentViewTitle').textContent = 'Students by Grade';
            
            const gradeGroups = {
                'A+': students.filter(s => s.grade === 'A+'),
                'A': students.filter(s => s.grade === 'A'),
                'B+': students.filter(s => s.grade === 'B+'),
                'B': students.filter(s => s.grade === 'B'),
                'C+': students.filter(s => s.grade === 'C+'),
                'C': students.filter(s => s.grade === 'C'),
                'D': students.filter(s => s.grade === 'D'),
                'F': students.filter(s => s.grade === 'F')
            };
            
            let html = '';
            Object.entries(gradeGroups).forEach(([grade, gradeStudents]) => {
                if (gradeStudents.length > 0) {
                    html += `
                        <div style="margin-bottom: 30px;">
                            <h3 style="margin-bottom: 15px; padding: 10px 20px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border-radius: 25px; display: inline-flex; align-items: center; gap: 10px;">
                                <span class="grade-badge ${getGradeClass(grade)}" style="background: white; color: #333;">${grade}</span>
                                ${gradeStudents.length} Student${gradeStudents.length > 1 ? 's' : ''}
                            </h3>
                    `;
                    
                    gradeStudents.forEach((student, index) => {
                        const isTopper = student.marks === Math.max(...students.map(s => s.marks));
                        const cardClass = `student-card ${student.passed ? 'passed' : 'failed'} ${isTopper ? 'topper' : ''}`;
                        
                        html += `
                            <div class="${cardClass}" style="animation-delay: ${index * 0.1}s; margin-bottom: 15px;">
                                <div class="student-header">
                                    <div>
                                        <div class="student-name">${student.name}</div>
                                        <div class="student-id">ID: ${student.id}</div>
                                    </div>
                                    <div class="student-marks">${student.marks}/100</div>
                                </div>
                                <div class="student-details">
                                    <div class="detail-item">
                                        <span class="detail-label">Subject:</span>
                                        <span class="detail-value">${student.subject}</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Status:</span>
                                        <span class="student-status status-${student.passed ? 'passed' : 'failed'}">
                                            ${student.passed ? '✅ PASSED' : '❌ FAILED'}
                                        </span>
                                    </div>
                                </div>
                                <div class="student-actions">
                                    <button class="btn btn-warning btn-sm" onclick="editStudentById('${student.id}')">
                                        <span>✏️</span> Edit
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="deleteStudentById('${student.id}')">
                                        <span>🗑️</span> Delete
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                }
            });
            
            if (html === '') {
                html = `
                    <div class="empty-state">
                        <div class="empty-icon">📊</div>
                        <h3 class="empty-title">No Grade Data</h3>
                        <p class="empty-text">Add students to see grade distribution.</p>
                    </div>
                `;
            }
            
            document.getElementById('resultsContainer').innerHTML = html;
        }

        function calculateAverage() {
            if (students.length === 0) {
                showNotification('No students added yet! 📚', 'error');
                return;
            }

            const average = students.reduce((sum, s) => sum + s.marks, 0) / students.length;
            const roundedAverage = Math.round(average * 100) / 100;
            
            showNotification(`Class Average: ${roundedAverage} marks 📊`, 'info');
            
            // Show detailed statistics
            currentView = 'stats';
            setActiveView('calculateAverage');
            document.getElementById('currentViewTitle').textContent = 'Detailed Statistics';
            
            const highest = Math.max(...students.map(s => s.marks));
            const lowest = Math.min(...students.map(s => s.marks));
            const passed = students.filter(s => s.passed).length;
            const failed = students.length - passed;
            const passRate = Math.round((passed / students.length) * 100);
            
            const container = document.getElementById('resultsContainer');
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 30px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 3rem; font-weight: bold; margin-bottom: 10px;">${roundedAverage}</div>
                        <div style="font-size: 1.2rem; margin-bottom: 5px;">Class Average</div>
                        <div style="font-size: 1rem; opacity: 0.9;">Total: ${students.reduce((sum, s) => sum + s.marks, 0)} ÷ ${students.length}</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%); color: white; padding: 30px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 3rem; font-weight: bold; margin-bottom: 10px;">${highest}</div>
                        <div style="font-size: 1.2rem; margin-bottom: 5px;">Highest Score</div>
                        <div style="font-size: 1rem; opacity: 0.9;">Best Performance</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 30px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 3rem; font-weight: bold; margin-bottom: 10px;">${lowest}</div>
                        <div style="font-size: 1.2rem; margin-bottom: 5px;">Lowest Score</div>
                        <div style="font-size: 1rem; opacity: 0.9;">Needs Improvement</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 3rem; font-weight: bold; margin-bottom: 10px;">${passRate}%</div>
                        <div style="font-size: 1.2rem; margin-bottom: 5px;">Pass Rate</div>
                        <div style="font-size: 1rem; opacity: 0.9;">${passed} of ${students.length} passed</div>
                    </div>
                </div>
                
                <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 20px; color: #333;">📈 Performance Analysis</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 12px;">
                            <div style="font-size: 2rem; color: #28a745; margin-bottom: 10px;">✅</div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: #28a745;">${passed}</div>
                            <div style="color: #666;">Students Passed</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 12px;">
                            <div style="font-size: 2rem; color: #dc3545; margin-bottom: 10px;">❌</div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: #dc3545;">${failed}</div>
                            <div style="color: #666;">Students Failed</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 12px;">
                            <div style="font-size: 2rem; color: #4facfe; margin-bottom: 10px;">📊</div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: #4facfe;">${students.length}</div>
                            <div style="color: #666;">Total Students</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function findTopper() {
            if (students.length === 0) {
                showNotification('No students added yet! 👑', 'error');
                return;
            }

            const maxMarks = Math.max(...students.map(s => s.marks));
            const toppers = students.filter(s => s.marks === maxMarks);
            
            if (toppers.length === 1) {
                showNotification(`👑 Topper: ${toppers[0].name} with ${maxMarks} marks!`, 'success');
            } else {
                showNotification(`👑 ${toppers.length} students tied for top position with ${maxMarks} marks!`, 'success');
            }
            
            currentView = 'topper';
            setActiveView('findTopper');
            displayStudents(toppers, `🏆 Class Topper${toppers.length > 1 ? 's' : ''} (${maxMarks} marks)`, 'No students found for topper position.');
        }

        function searchStudents() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            
            if (searchTerm === '') {
                refreshCurrentView();
                return;
            }
            
            const filtered = students.filter(student => 
                student.name.toLowerCase().includes(searchTerm) ||
                student.id.toLowerCase().includes(searchTerm) ||
                student.subject.toLowerCase().includes(searchTerm) ||
                student.grade.toLowerCase().includes(searchTerm)
            );
            
            displayStudents(filtered, `Search Results for "${searchTerm}"`, `No students found matching "${searchTerm}"`);
        }

        function refreshCurrentView() {
            switch(currentView) {
                case 'dashboard': showDashboard(); break;
                case 'all': showAllStudents(); break;
                case 'passed': showPassedStudents(); break;
                case 'failed': showFailedStudents(); break;
                case 'grade': showByGrade(); break;
                case 'stats': calculateAverage(); break;
                case 'topper': findTopper(); break;
                default: showDashboard();
            }
        }

        function editStudent() {
            if (students.length === 0) {
                showNotification('No students to edit! 📝', 'error');
                return;
            }
            
            showModal(`
                <h3 style="margin-bottom: 20px; color: #4facfe;">✏️ Edit Student</h3>
                <div class="form-group">
                    <label>Select Student to Edit:</label>
                    <select id="editStudentSelect" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; margin-bottom: 15px;">
                        <option value="">Choose a student...</option>
                        ${students.map(s => `<option value="${s.id}">${s.name} (${s.id}) - ${s.marks} marks</option>`).join('')}
                    </select>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button class="btn btn-warning" onclick="selectStudentForEdit()">✏️ Edit Selected</button>
                </div>
            `);
        }

        function selectStudentForEdit() {
            const selectedId = document.getElementById('editStudentSelect').value;
            if (!selectedId) {
                showNotification('Please select a student to edit! 📝', 'error');
                return;
            }
            editStudentById(selectedId);
        }

        function editStudentById(studentId) {
            const student = students.find(s => s.id === studentId);
            if (!student) return;
            
            showModal(`
                <h3 style="margin-bottom: 20px; color: #4facfe;">✏️ Edit ${student.name}</h3>
                <form id="editForm">
                    <div class="form-group">
                        <label>Full Name:</label>
                        <input type="text" id="editName" value="${student.name}" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; margin-bottom: 15px;">
                    </div>
                    <div class="form-group">
                        <label>Student ID:</label>
                        <input type="text" id="editId" value="${student.id}" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; margin-bottom: 15px;">
                    </div>
                    <div class="form-group">
                        <label>Marks (0-100):</label>
                        <input type="number" id="editMarks" min="0" max="100" value="${student.marks}" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; margin-bottom: 15px;">
                    </div>
                    <div class="form-group">
                        <label>Subject:</label>
                        <select id="editSubject" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; margin-bottom: 15px;">
                            <option value="Mathematics" ${student.subject === 'Mathematics' ? 'selected' : ''}>Mathematics</option>
                            <option value="Physics" ${student.subject === 'Physics' ? 'selected' : ''}>Physics</option>
                            <option value="Chemistry" ${student.subject === 'Chemistry' ? 'selected' : ''}>Chemistry</option>
                            <option value="Biology" ${student.subject === 'Biology' ? 'selected' : ''}>Biology</option>
                            <option value="English" ${student.subject === 'English' ? 'selected' : ''}>English</option>
                            <option value="History" ${student.subject === 'History' ? 'selected' : ''}>History</option>
                            <option value="Geography" ${student.subject === 'Geography' ? 'selected' : ''}>Geography</option>
                            <option value="Computer Science" ${student.subject === 'Computer Science' ? 'selected' : ''}>Computer Science</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                        <button type="submit" class="btn btn-success">💾 Save Changes</button>
                    </div>
                </form>
            `);
            
            document.getElementById('editForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const newName = document.getElementById('editName').value.trim();
                const newId = document.getElementById('editId').value.trim();
                const newMarks = parseInt(document.getElementById('editMarks').value);
                const newSubject = document.getElementById('editSubject').value;
                
                // Check if new ID already exists (excluding current student)
                if (newId !== student.id && students.some(s => s.id === newId)) {
                    showNotification('Student ID already exists! Please use a unique ID 🆔', 'error');
                    return;
                }
                
                if (newName && newId && !isNaN(newMarks) && newMarks >= 0 && newMarks <= 100 && newSubject) {
                    const studentIndex = students.findIndex(s => s.id === studentId);
                    students[studentIndex] = {
                        ...student,
                        id: newId,
                        name: newName,
                        marks: newMarks,
                        subject: newSubject,
                        passed: newMarks >= 40,
                        grade: calculateGrade(newMarks)
                    };
                    
                    updateStats();
                    saveData();
                    refreshCurrentView();
                    closeModal();
                    showNotification(`${newName} updated successfully! ✨`, 'success');
                } else {
                    showNotification('Please fill all fields correctly! 📝', 'error');
                }
            });
        }

        function deleteStudent() {
            if (students.length === 0) {
                showNotification('No students to delete! 🗑️', 'error');
                return;
            }
            
            showModal(`
                <h3 style="margin-bottom: 20px; color: #dc3545;">🗑️ Delete Student</h3>
                <p style="margin-bottom: 20px; color: #666;">Select a student to delete. This action cannot be undone!</p>
                <div class="form-group">
                    <label>Select Student to Delete:</label>
                    <select id="deleteStudentSelect" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; margin-bottom: 15px;">
                        <option value="">Choose a student...</option>
                        ${students.map(s => `<option value="${s.id}">${s.name} (${s.id}) - ${s.marks} marks</option>`).join('')}
                    </select>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button class="btn btn-danger" onclick="confirmDeleteStudent()">🗑️ Delete Selected</button>
                </div>
            `);
        }

        function confirmDeleteStudent() {
            const selectedId = document.getElementById('deleteStudentSelect').value;
            if (!selectedId) {
                showNotification('Please select a student to delete! 🗑️', 'error');
                return;
            }
            deleteStudentById(selectedId);
        }

        function deleteStudentById(studentId) {
            const student = students.find(s => s.id === studentId);
            if (!student) return;
            
            showModal(`
                <h3 style="margin-bottom: 20px; color: #dc3545;">⚠️ Confirm Deletion</h3>
                <p style="margin-bottom: 20px; color: #666;">Are you sure you want to delete this student?</p>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #dc3545;">
                    <div style="font-weight: 600; color: #333; margin-bottom: 5px;">${student.name}</div>
                    <div style="color: #666;">ID: ${student.id} • Subject: ${student.subject} • Marks: ${student.marks}/100</div>
                </div>
                <p style="color: #dc3545; font-weight: 600; margin-bottom: 20px;">This action cannot be undone!</p>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button class="btn btn-danger" onclick="executeDelete('${studentId}')">🗑️ Yes, Delete</button>
                </div>
            `);
        }

        function executeDelete(studentId) {
            const student = students.find(s => s.id === studentId);
            const studentName = student.name;
            
            students = students.filter(s => s.id !== studentId);
            updateStats();
            saveData();
            refreshCurrentView();
            closeModal();
            showNotification(`${studentName} deleted successfully! 🗑️`, 'success');
        }

        function clearAllData() {
            if (students.length === 0) {
                showNotification('No data to clear! 🧹', 'info');
                return;
            }
            
            showModal(`
                <h3 style="margin-bottom: 20px; color: #dc3545;">⚠️ Clear All Data</h3>
                <p style="margin-bottom: 20px; color: #666;">This will permanently delete all ${students.length} students from the system.</p>
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
                    <strong>Warning:</strong> This action cannot be undone!
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button class="btn btn-danger" onclick="confirmClearAll()">🧹 Clear All Data</button>
                </div>
            `);
        }

        function confirmClearAll() {
            students = [];
            updateStats();
            saveData();
            showDashboard();
            closeModal();
            showNotification('All data cleared successfully! 🧹', 'success');
        }

        function exportData() {
            if (students.length === 0) {
                showNotification('No data to export! 📁', 'error');
                return;
            }
            
            const dataStr = JSON.stringify(students, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `student-marks-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showNotification(`Exported ${students.length} student records! 📁`, 'success');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        if (Array.isArray(importedData)) {
                            students = importedData;
                            updateStats();
                            saveData();
                            refreshCurrentView();
                            showNotification(`Imported ${students.length} student records! 📥`, 'success');
                        } else {
                            showNotification('Invalid file format! 📥', 'error');
                        }
                    } catch (error) {
                        showNotification('Error reading file! 📥', 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function generateReport() {
            if (students.length === 0) {
                showNotification('No data to generate report! 📋', 'error');
                return;
            }
            
            currentView = 'report';
            setActiveView('generateReport');
            document.getElementById('currentViewTitle').textContent = 'Comprehensive Report';
            
            const total = students.length;
            const passed = students.filter(s => s.passed).length;
            const failed = total - passed;
            const average = Math.round(students.reduce((sum, s) => sum + s.marks, 0) / total);
            const highest = Math.max(...students.map(s => s.marks));
            const lowest = Math.min(...students.map(s => s.marks));
            const passRate = Math.round((passed / total) * 100);
            
            // Grade distribution
            const gradeDistribution = {};
            students.forEach(student => {
                gradeDistribution[student.grade] = (gradeDistribution[student.grade] || 0) + 1;
            });
            
            // Subject-wise stats
            const subjectStats = {};
            students.forEach(student => {
                if (!subjectStats[student.subject]) {
                    subjectStats[student.subject] = { total: 0, sum: 0, passed: 0 };
                }
                subjectStats[student.subject].total++;
                subjectStats[student.subject].sum += student.marks;
                if (student.passed) subjectStats[student.subject].passed++;
            });
            
            let html = `
                <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px;">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h2 style="color: #4facfe; margin-bottom: 10px;">📋 Student Performance Report</h2>
                        <p style="color: #666; font-size: 1.1rem;">Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 12px; border: 2px solid #4facfe;">
                            <div style="font-size: 2.5rem; color: #4facfe; margin-bottom: 10px;">👥</div>
                            <div style="font-size: 1.8rem; font-weight: bold; color: #333;">${total}</div>
                            <div style="color: #666;">Total Students</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 12px; border: 2px solid #28a745;">
                            <div style="font-size: 2.5rem; color: #28a745; margin-bottom: 10px;">✅</div>
                            <div style="font-size: 1.8rem; font-weight: bold; color: #333;">${passed}</div>
                            <div style="color: #666;">Passed</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 12px; border: 2px solid #dc3545;">
                            <div style="font-size: 2.5rem; color: #dc3545; margin-bottom: 10px;">❌</div>
                            <div style="font-size: 1.8rem; font-weight: bold; color: #333;">${failed}</div>
                            <div style="color: #666;">Failed</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 12px; border: 2px solid #ffc107;">
                            <div style="font-size: 2.5rem; color: #ffc107; margin-bottom: 10px;">📊</div>
                            <div style="font-size: 1.8rem; font-weight: bold; color: #333;">${average}</div>
                            <div style="color: #666;">Average</div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div style="padding: 20px; background: #f8f9fa; border-radius: 12px;">
                            <h4 style="color: #333; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                                <span>📈</span> Performance Metrics
                            </h4>
                            <div style="margin-bottom: 10px;"><strong>Highest Score:</strong> ${highest}/100</div>
                            <div style="margin-bottom: 10px;"><strong>Lowest Score:</strong> ${lowest}/100</div>
                            <div style="margin-bottom: 10px;"><strong>Pass Rate:</strong> ${passRate}%</div>
                            <div><strong>Range:</strong> ${highest - lowest} points</div>
                        </div>
                        
                        <div style="padding: 20px; background: #f8f9fa; border-radius: 12px;">
                            <h4 style="color: #333; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                                <span>🎯</span> Grade Distribution
                            </h4>
                            ${Object.entries(gradeDistribution).sort().map(([grade, count]) => 
                                `<div style="margin-bottom: 8px; display: flex; justify-content: space-between;">
                                    <span class="grade-badge ${getGradeClass(grade)}">${grade}</span>
                                    <span><strong>${count}</strong> student${count > 1 ? 's' : ''}</span>
                                </div>`
                            ).join('')}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <h4 style="color: #333; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            <span>📚</span> Subject-wise Performance
                        </h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            ${Object.entries(subjectStats).map(([subject, stats]) => {
                                const avg = Math.round(stats.sum / stats.total);
                                const rate = Math.round((stats.passed / stats.total) * 100);
                                return `
                                    <div style="padding: 15px; background: white; border-radius: 10px; border: 2px solid #e9ecef;">
                                        <div style="font-weight: 700; color: #333; margin-bottom: 8px;">${subject}</div>
                                        <div style="color: #4facfe; font-size: 1.3rem; font-weight: 600;">${avg}/100</div>
                                        <div style="color: #666; font-size: 0.9rem;">Average Score</div>
                                        <div style="margin-top: 8px; color: ${rate >= 70 ? '#28a745' : rate >= 50 ? '#ffc107' : '#dc3545'}; font-weight: 600;">
                                            ${rate}% Pass Rate
                                        </div>
                                        <div style="color: #666; font-size: 0.8rem;">${stats.passed}/${stats.total} passed</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid #e9ecef;">
                        <button class="btn btn-success" onclick="printReport()" style="margin-right: 10px;">
                            <span>🖨️</span> Print Report
                        </button>
                        <button class="btn btn-secondary" onclick="exportData()">
                            <span>📁</span> Export Data
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('resultsContainer').innerHTML = html;
            showNotification('Comprehensive report generated! 📋', 'success');
        }

        function printReport() {
            window.print();
        }

        function showModal(content) {
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('actionModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('actionModal').classList.remove('show');
        }

        function showNotification(message, type) {
            const existing = document.querySelector('.notification');
            if (existing) {
                existing.remove();
            }

            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icons = {
                success: '✅',
                error: '❌',
                info: 'ℹ️',
                warning: '⚠️'
            };
            
            notification.innerHTML = `
                <span>${icons[type] || 'ℹ️'}</span>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 400);
            }, 4000);
        }

        function saveData() {
            try {
                const data = JSON.stringify(students);
                // Using a simple variable to store data since localStorage is not available
                window.studentData = data;
            } catch (error) {
                console.log('Data saved in memory');
            }
        }

        function loadData() {
            try {
                const data = window.studentData;
                if (data) {
                    students = JSON.parse(data);
                    updateStats();
                }
            } catch (error) {
                students = [];
            }
        }

        // Close modal when clicking outside
        document.getElementById('actionModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Initialize the system
        updateStats();
    </script>
</body>
</html>